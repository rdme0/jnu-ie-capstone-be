# ë””ì§€í„¸ ì·¨ì•½ê³„ì¸µì„ ìœ„í•œ ëŒ€í™”í˜• ìŒì„± AI ì—ì´ì „íŠ¸ í‚¤ì˜¤ìŠ¤í¬ êµ¬í˜„

![Project Banner](https://img.shields.io/badge/Project-Capstone-blue) ![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.5.4-brightgreen) ![Kotlin](https://img.shields.io/badge/Kotlin-2.2.0-purple) ![Gemini](https://img.shields.io/badge/AI-Gemini%20Live-orange)

## ğŸ“– í”„ë¡œì íŠ¸ ì†Œê°œ (Introduction)

ë³¸ í”„ë¡œì íŠ¸ëŠ” ê³ ë ¹ì¸µ ë° ì¥ì• ì¸ ë“± **ë””ì§€í„¸ ì·¨ì•½ê³„ì¸µ**ì´ ê²ªëŠ” í‚¤ì˜¤ìŠ¤í¬ ì‚¬ìš©ì˜ ì–´ë ¤ì›€(Digital Divide)ì„ í•´ê²°í•˜ê³ ì ì‹œë„ëœ í•™ìˆ  ì—°êµ¬ì…ë‹ˆë‹¤. ê¸°ì¡´ í„°ì¹˜ ì¸í„°í˜ì´ìŠ¤ì˜ ë³µì¡ì„±ì„ ë³´ì™„í•˜ê¸° ìœ„í•´, **ìì—°ìŠ¤ëŸ¬ìš´ ìŒì„± ëŒ€í™”**ë¥¼ í™œìš©í•œ **ììœ¨í˜• AI ì—ì´ì „íŠ¸ í‚¤ì˜¤ìŠ¤í¬** í”„ë¡œí† íƒ€ì…ì„ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤.

**Google Gemini Live**ì˜ ì‹¤ì‹œê°„ ë©€í‹°ëª¨ë‹¬ ìƒí˜¸ì‘ìš©ê³¼ **RAG(ê²€ìƒ‰ ì¦ê°• ìƒì„±)** ê¸°ìˆ ì„ ì ‘ëª©í•˜ì—¬, ì‚¬ìš©ì ì˜ë„ë¥¼ íŒŒì•…í•˜ê³  ì ì ˆí•œ ë©”ë‰´ë¥¼ ì¶”ì²œí•˜ëŠ” ì‹œìŠ¤í…œì„ ëª©í‘œë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤.

### ğŸ’¡ ì—°êµ¬ ë°°ê²½ ë° ëª©í‘œ
- **ì ‘ê·¼ì„± í–¥ìƒ**: ë³µì¡í•œ UI í•™ìŠµ ì—†ì´ ìŒì„±ë§Œìœ¼ë¡œ ì£¼ë¬¸ ê°€ëŠ¥í•œ í™˜ê²½ ëª¨ìƒ‰.
- **ìœ ì—°í•œ ìƒí˜¸ì‘ìš©**: ì •í˜•í™”ëœ ë²„íŠ¼ ì¡°ì‘ì˜ í•œê³„ë¥¼ ë„˜ì–´, ìì—°ì–´ ëŒ€í™”ë¥¼ í†µí•œ ì£¼ë¬¸ ì²˜ë¦¬ ì‹œë„.
- **ì‹ ë¢°ì„± í™•ë³´**: ìƒì„±í˜• AIì˜ ê³ ì§ˆì ì¸ **í™˜ê°(Hallucination) í˜„ìƒ**ì„ **State Machine**ê³¼ **RAG**ë¥¼ í†µí•´ **ì™„í™”**í•˜ê³ ì ë…¸ë ¥í•¨.

---

## âœ¨ ì£¼ìš” ê¸°ëŠ¥ (Key Features)

### 1. ììœ¨í˜• AI ì—ì´ì „íŠ¸ (Autonomous AI Agent)
ë‹¨ìˆœ ì§ˆì˜ì‘ë‹µì„ ë„˜ì–´, ì£¼ë¬¸ ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ ìŠ¤ìŠ¤ë¡œ íŒë‹¨í•˜ëŠ” ì—ì´ì „íŠ¸ êµ¬ì¡°ë¥¼ ì§€í–¥í•©ë‹ˆë‹¤.
- **ë„êµ¬ ì‚¬ìš©**: ì‚¬ìš©ìì˜ ë°œí™”ì— ë”°ë¼ **ë©”ë‰´ ê²€ìƒ‰(RAG)**ê³¼ **ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°(Function Call)** ì¤‘ ì ì ˆí•œ í–‰ë™ì„ ì„ íƒí•©ë‹ˆë‹¤.
- **íë¦„ ì œì–´**: **ë©”ë‰´ ì„ íƒ** â†’ **ê²°ì œ í™•ì¸** â†’ **ì™„ë£Œ**ë¡œ ì´ì–´ì§€ëŠ” ì£¼ë¬¸ í”„ë¡œì„¸ìŠ¤ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

### 2. ì‹¤ì‹œê°„ ë©€í‹°ëª¨ë‹¬ ìŠ¤íŠ¸ë¦¬ë° (Gemini Live)
- **Native Audio**: ìŒì„±ì„ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ì§€ ì•Šê³  ëª¨ë¸ì´ ì§ì ‘ ë“£ê³  ì´í•´í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬, ê¸°ì¡´ íŒŒì´í”„ë¼ì¸(STT-LLM-TTS) ëŒ€ë¹„ ì§€ì—° ì‹œê°„ì„ ë‹¨ì¶•í•˜ì˜€ìŠµë‹ˆë‹¤.
- **ì´ì¤‘ ì…ë ¥ ì „ëµ (Dual-Input Strategy)**: ìŒì„± ë°ì´í„°(Fast Path)ì™€ ì‹œìŠ¤í…œ ì»¨í…ìŠ¤íŠ¸(Slow Path)ë¥¼ ë¶„ë¦¬ ì²˜ë¦¬í•˜ì—¬ í‰ê·  ì‘ë‹µ ì†ë„ **2.74ì´ˆ**ë¥¼ ë‹¬ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.

### 3. ì˜ë¯¸ ê¸°ë°˜ ë©”ë‰´ ê²€ìƒ‰ (pgvector RAG)
- **ë²¡í„° ê²€ìƒ‰**: `pgvector`ì™€ `Hibernate Vector`ë¥¼ í™œìš©í•˜ì—¬ ë‹¨ìˆœíˆ ë©”ë‰´ëª…ì´ ì¼ì¹˜í•˜ì§€ ì•Šì•„ë„, ì˜ë¯¸ì ìœ¼ë¡œ ìœ ì‚¬í•œ ë©”ë‰´ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤. (ì˜ˆ: "ì´ˆë¡ì´ˆë¡í•œ ê±°" â†’ "ë§ì°¨ í”„ë¼í‘¸ì¹˜ë…¸")

### 4. ìƒíƒœ ê¸°ë°˜ ì•ˆì „ì¥ì¹˜ (Spring State Machine)
- AIì˜ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ í–‰ë™ì„ ì œì–´í•˜ê¸° ìœ„í•´, ìƒíƒœ ë¨¸ì‹ ì„ ë„ì…í•˜ì—¬ ê° ë‹¨ê³„ì—ì„œ í—ˆìš©ëœ ë°œí™”ì™€ í–‰ë™ë§Œì„ ìˆ˜í–‰í•˜ë„ë¡ ì œí•œí•˜ì˜€ìŠµë‹ˆë‹¤.

---

## âš ï¸ í•œê³„ì  (Limitations)

ë³¸ ì‹œìŠ¤í…œì€ í”„ë¡œí† íƒ€ì… ë‹¨ê³„ë¡œ, ë‹¤ìŒê³¼ ê°™ì€ ê¸°ìˆ ì  í•œê³„ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.

1.  **ì”ì¡´í•˜ëŠ” í™˜ê° í˜„ìƒ (Residual Hallucinations)**: RAGì™€ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ì„ í†µí•´ í™˜ê°ì„ ì–µì œí–ˆìœ¼ë‚˜, LLMì˜ í™•ë¥ ì  íŠ¹ì„±ìƒ ê°„í˜¹ ì˜ë„ì™€ ë‹¤ë¥¸ ë©”ë‰´ë¥¼ ë‹´ê±°ë‚˜ ë„êµ¬ í˜¸ì¶œì„ ëˆ„ë½í•˜ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì„±ê³µë¥  95%).
2.  **ë„êµ¬ì˜ ì œí•œ**: í˜„ì¬ëŠ” `ì¶”ê°€`ì™€ `ì‚­ì œ` ê¸°ëŠ¥ë§Œ êµ¬í˜„ë˜ì–´ ìˆì–´, "ë°©ê¸ˆ ë„£ì€ ê±°ì—ì„œ ìƒ· ë¹¼ì¤˜"ì™€ ê°™ì€ ë³µì¡í•œ ì˜µì…˜ ìˆ˜ì •(`UPDATE`)ì—ëŠ” í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤.
3.  **ì‹¤ì¦ í‰ê°€ì˜ ë¶€ì¬**: ì‹¤í—˜ í™˜ê²½ì—ì„œì˜ ë²¤ì¹˜ë§ˆí¬ í…ŒìŠ¤íŠ¸ëŠ” ìˆ˜í–‰í•˜ì˜€ìœ¼ë‚˜, ì‹¤ì œ ë””ì§€í„¸ ì·¨ì•½ê³„ì¸µ(ê³ ë ¹ì¸µ ë“±)ì„ ëŒ€ìƒìœ¼ë¡œ í•œ ì‚¬ìš©ì„± í‰ê°€(Usability Test)ëŠ” ìˆ˜í–‰ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

---

## API ëª…ì„¸
- **API ëª…ì„¸ì„œ (Notion)**: [ë°”ë¡œê°€ê¸°](https://spectacled-knight-5db.notion.site/API-28e399dcba9280008cd8f9008b04abcf?p=295399dcba9281a386baf76042c271ab&pm=s)

--- 
## ğŸ— ì‹œìŠ¤í…œ êµ¬ì„± (System Architecture)

### ğŸ›  ê¸°ìˆ  ìŠ¤íƒ
| êµ¬ë¶„            | ê¸°ìˆ                                                    |
|---------------|------------------------------------------------------|
| **Language**  | **Kotlin 2.2.0**, **Java 21**                        |
| **Framework** | **Spring Boot 3.5.4**, WebFlux, Spring State Machine |
| **Database**  | **PostgreSQL 17** (pgvector)                         |
| **AI**        | **Google Gemini Live**                               |
| **Protocol**  | **WebSocket**                                        |

### ğŸ”„ ë°ì´í„° íë¦„ (Data Flow)
```mermaid
sequenceDiagram
    autonumber
    actor User
    participant H as Handler
    participant S as Service
    participant M as Menu/Cart
    participant G as Gemini

    User->>H: WebSocket Connect
    H->>S: Init Session Loop
    S->>G: Connect Gemini Live
    G-->>H: Server Ready Signal
    H->>User: Display 'Listening'

    par Real-time Interaction
        loop Voice Stream
            User->>S: Audio Chunk (PCM)
            S->>G: Stream Audio
        end
    and AI Response
        loop Response Event
            G-->>S: Gemini Output
            
            alt Audio Response
                S->>User: Play TTS Audio
            else RAG Search (Tool Call)
                S->>M: Vector Search (pgvector)
                M-->>S: Menu List
                S->>G: Submit Tool Result
            else Update Cart (Tool Call)
                S->>M: Add/Remove Item
                M-->>S: Result
                S->>User: Update UI (Cart)
                S->>G: Submit Tool Result
            end
        end
    end
```

### ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ (ER Diagram)
```mermaid
erDiagram
	direction LR
	member {
		bigint id PK ""  
		varchar(255) email  ""  
		varchar(255) provider  ""  
		varchar(255) role  ""  
		timestamp_with_time_zone created_at  ""  
		timestamp_with_time_zone updated_at  ""  
	}

	store {
		bigint id PK ""  
		bigint owner_id FK ""  
		varchar(255) name  ""  
		timestamp_with_time_zone created_at  ""  
		timestamp_with_time_zone updated_at  ""  
	}

	menu {
		bigint id PK ""  
		bigint store_id FK ""  
		varchar(255) name  ""  
		bigint price  ""  
		vector(768) embedding  ""  
		timestamp_with_time_zone created_at  ""  
		timestamp_with_time_zone updated_at  ""  
	}

	option {
		bigint id PK ""  
		bigint menu_id FK ""  
		varchar(255) name  ""  
		bigint price  ""  
		timestamp_with_time_zone created_at  ""  
		timestamp_with_time_zone updated_at  ""  
	}

	member||--o{store:"owner_id"
	store||--o{menu:"store_id"
	menu||--o{option:"menu_id"
```

### ğŸ§© í´ë˜ìŠ¤ êµ¬ì¡° (Class Diagram)
```mermaid
classDiagram
direction TB

    %% 1. ë„ë©”ì¸ ì—”í‹°í‹° (ë°ì´í„°)
    class Member {
        <<Entity>>
    }
    class Store {
        <<Entity>>
    }
    class Menu {
        <<Entity>>
    }
    class Option {
        <<Entity>>
    }

    %% 2. ì„œë¹„ìŠ¤ ë¡œì§
    class KioskAiSessionHandler {
        <<WebSocket Handler>>
    }
    class KioskSessionService {
        <<Main Service>>
    }
    class KioskShoppingCartService {
        <<Service>>
    }
    class MenuCoordinateService {
        <<Service>>
    }
    class GeminiLiveClient {
        <<Infrastructure>>
    }

    %% 3. ìƒíƒœ ë° Enum (í•„ìš”ì‹œ ì œê±° ê°€ëŠ¥)
    class SessionState {
        <<Enum>>
    }
    class GeminiFunctionSignature {
        <<Enum>>
    }

    %% ê´€ê³„ ì„¤ì •
    Member "1" --> "*" Store : owns
    Store "1" --> "*" Menu : has
    Menu "1" --> "*" Option : has

    KioskAiSessionHandler --> KioskSessionService : delegates
    
    KioskSessionService --> GeminiLiveClient : streams (Audio/Text)
    KioskSessionService --> MenuCoordinateService : RAG search
    KioskSessionService --> KioskShoppingCartService : modifies cart
    KioskSessionService ..> SessionState : manages state
    KioskSessionService ..> GeminiFunctionSignature : executes tools

    KioskShoppingCartService --> MenuCoordinateService : fetches info
    
    MenuCoordinateService ..> Menu : queries
    MenuCoordinateService ..> Option : queries
```
---

## ğŸš€ ì‹œì‘í•˜ê¸° (Getting Started)

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

* **Java 21**
* **Google AI Studio API Key**

### 1. í”„ë¡œì íŠ¸ í´ë¡ 

```bash
git clone https://github.com/rdme0/jnu-ie-capstone-be.git
cd jnu-ie-capstone-be
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

í”„ë¡œì íŠ¸ ë£¨íŠ¸ ê²½ë¡œì— `.env` íŒŒì¼ì„ ìƒì„±í•˜ê³ , ì•„ë˜ ë‚´ìš©ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”.

```properties
# 1. Security & Auth
AES256_KEY=
JWT_SECRET_KEY=

# 2. OAuth (Kakao)
KAKAO_CLIENT_ID=
KAKAO_CLIENT_SECRET=

# 3. AI Service
GEMINI_API_KEY=

# 4. Server Configuration
DEV_URL=
PROD_URL=

# 5. Database (Development)
DEV_POSTGRES_URL=
DEV_POSTGRES_PORT=
DEV_POSTGRES_USERNAME=
DEV_POSTGRES_PASSWORD=
DEV_POSTGRES_DATABASE=

# 6. Database (Production)
PROD_POSTGRES_URL=
PROD_POSTGRES_PORT=
PROD_POSTGRES_USERNAME=
PROD_POSTGRES_PASSWORD=
PROD_POSTGRES_DATABASE=

```

### 3. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰

```bash
./gradlew bootRun
```

---

## ğŸ“Š ì„±ëŠ¥ í‰ê°€ (Performance)
- **í‰ê·  ì‘ë‹µ ì†ë„**: 2.74ì´ˆ (End-to-End)
- **ì£¼ë¬¸ ì„±ê³µë¥ **: 95% (100íšŒ ë²¤ì¹˜ë§ˆí¬ í…ŒìŠ¤íŠ¸ ê¸°ì¤€)
- **ìŒì„± ì²˜ë¦¬**: ë°±í”„ë ˆì…”(Backpressure) ì œì–´ê°€ ì ìš©ëœ 128 ì²­í¬ ë²„í¼ë§.